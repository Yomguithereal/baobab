/* baobab.js - Version: 1.0.0-rc1 - Author: Yomguithereal (Guillaume Plique) */
!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var r;r="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,r.Baobab=t()}}(function(){var t;return function r(t,e,n){function i(s,a){if(!e[s]){if(!t[s]){var h="function"==typeof require&&require;if(!a&&h)return h(s,!0);if(o)return o(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var c=e[s]={exports:{}};t[s][0].call(c.exports,function(r){var e=t[s][1][r];return i(e?e:r)},c,c.exports,r,t,e,n)}return e[s].exports}for(var o="function"==typeof require&&require,s=0;s<n.length;s++)i(n[s]);return i}({1:[function(t,r){r.exports={autoCommit:!0,asynchronous:!0,mixins:[],validate:null}},{}],2:[function(t,r){var e=t("./src/baobab.js"),n=t("./src/helpers.js");Object.defineProperty(e,"version",{value:"1.0.0-rc1"}),e.getIn=n.getIn,r.exports=e},{"./src/baobab.js":4,"./src/helpers.js":7}],3:[function(r,e,n){(function(){"use strict";function r(t){var r,e,n=[];for(r=0,e=t.length;e>r;r++)n.push(t[r].handler);return n}var i={once:"boolean",scope:"object"},o=function(){this._enabled=!0,this._children=[],this._handlers={},this._handlersAll=[]};o.prototype.on=function(t,r,e){var n,s,a,h,u,c;if("function"==typeof r){for(u="string"==typeof t?[t]:t,n=0,s=u.length;n!==s;n+=1)if(h=u[n]){this._handlers[h]||(this._handlers[h]=[]),c={handler:r};for(a in e||{}){if(!i[a])throw new Error('The option "'+a+'" is not recognized by Emmett.');c[a]=e[a]}this._handlers[h].push(c)}}else if(t&&"object"==typeof t&&!Array.isArray(t))for(h in t)o.prototype.on.call(this,h,t[h],r);else{if("function"!=typeof t)throw new Error("Wrong arguments.");c={handler:t};for(a in e||{}){if(!i[a])throw new Error('The option "'+a+'" is not recognized by Emmett.');c[a]=e[a]}this._handlersAll.push(c)}return this},o.prototype.once=function(t,r,e){if("function"==typeof r)e=e||{},e.once=!0,this.on(t,r,e);else{if((!t||"object"!=typeof t||Array.isArray(t))&&"function"!=typeof t)throw new Error("Wrong arguments.");r=r||{},r.once=!0,this.on(t,r)}return this},o.prototype.off=function(t,r){var e,n,i,o,s,a,h,u="string"==typeof t?[t]:t;if(1===arguments.length&&"function"==typeof u){r=arguments[0];for(s in this._handlers){for(a=[],e=0,n=this._handlers[s].length;e!==n;e+=1)this._handlers[s][e].handler!==r&&a.push(this._handlers[s][e]);this._handlers[s]=a}for(a=[],e=0,n=this._handlersAll.length;e!==n;e+=1)this._handlersAll[e].handler!==r&&a.push(this._handlersAll[e]);this._handlersAll=a}else if(2===arguments.length)for(e=0,n=u.length;e!==n;e+=1){if(h=u[e],this._handlers[h]){for(a=[],i=0,o=this._handlers[h].length;i!==o;i+=1)this._handlers[h][i].handler!==r&&a.push(this._handlers[h][i]);this._handlers[h]=a}this._handlers[h]&&0===this._handlers[h].length&&delete this._handlers[h]}return this},o.prototype.unbindAll=function(){var t;this._handlersAll=[];for(t in this._handlers)delete this._handlers[t];return this},o.prototype.emit=function(t,r){var e,n,i,o,s,a,h,u,c,l,f="string"==typeof t?[t]:t;if(!this._enabled)return this;for(r=void 0===r?{}:r,e=0,n=f.length;e!==n;e+=1)if(l=f[e],c=(this._handlers[l]||[]).concat(this._handlersAll),c.length){for(h={type:l,data:r||{},target:this},a=[],i=0,o=c.length;i!==o;i+=1)(this._handlers[l]&&this._handlers[l].indexOf(c[i])>=0||this._handlersAll.indexOf(c[i])>=0)&&(c[i].handler.call("scope"in c[i]?c[i].scope:this,h),c[i].once&&a.push(c[i]));for(s=0;s<a.length;s++)this._handlers[l].splice(a.indexOf(a[s]),1)}for(e=0,n=this._children.length;e!==n;e+=1)u=this._children[e],u.emit.apply(u,arguments);return this},o.prototype.child=function(){var t=this,r=new o;return r.on("emmett:kill",function(){if(t._children)for(var e=0,n=t._children.length;n>e;e++)if(t._children[e]===r){t._children.splice(e,1);break}}),this._children.push(r),r},o.prototype.listeners=function(t){var e,n,i,o=[];if(t)for(o=r(this._handlers[t]),n=0,i=this._children.length;i>n;n++)o=o.concat(this._children[n].listeners(t));else{o=r(this._handlersAll);for(e in this._handlers)o=o.concat(r(this._handlers[e]));for(n=0,i=this._children.length;i>n;n++)o=o.concat(this._children[n].listeners())}return o},o.prototype.kill=function(){if(this.emit("emmett:kill"),this.unbindAll(),this._handlers=null,this._handlersAll=null,this._enabled=!1,this._children)for(var t=0,r=this._children.length;r>t;t++)this._children[t].kill();this._children=null},o.prototype.disable=function(){return this._enabled=!1,this},o.prototype.enable=function(){return this._enabled=!0,this},o.version="2.1.2","undefined"!=typeof n?("undefined"!=typeof e&&e.exports&&(n=e.exports=o),n.Emitter=o):"function"==typeof t&&t.amd?t("emmett",[],function(){return o}):this.Emitter=o}).call(this)},{}],4:[function(t,r){function e(t){return t+"$"+(new Date).getTime()+(""+Math.random()).replace("0.","")}function n(t,r){function e(t){this[t]=function(){var r=this.root[t].apply(this.root,arguments);return r instanceof i?this:r}}if(arguments.length<1&&(t={}),!(this instanceof n))return new n(t,r);if(!l.Object(t)&&!l.Array(t))throw Error("Baobab: invalid data.");o.call(this),this.options=s.shallowMerge(c,r),this._transaction={},this._future=void 0,this._cursors={},this.data=s.deepClone(t),this.root=this.select([]),["get","set","unset","update"].forEach(e.bind(this)),this.mixin=u.baobab(this)}var i=t("./cursor.js"),o=t("emmett"),s=t("./helpers.js"),a=t("./update.js"),h=t("./merge.js"),u=t("./mixins.js"),c=t("../defaults.js"),l=t("./type.js");s.inherits(n,o),n.prototype.select=function(t){if(!t)throw Error("Baobab.select: invalid path.");if(arguments.length>1&&(t=s.arrayOf(arguments)),!l.Path(t))throw Error("Baobab.select: invalid path.");t=[].concat(t);var r,n=l.ComplexPath(t);n&&(r=s.solvePath(this.data,t));var o=t.map(function(t){return l.Function(t)?e("fn"):l.Object(t)?e("ob"):t}).join("λ");if(this._cursors[o])return this._cursors[o];var a=new i(this,t,r,o);return this._cursors[o]=a,a},n.prototype.stack=function(t){var r=this;if(!l.Object(t))throw Error("Baobab.update: wrong specification.");return this._transaction=h(t,this._transaction),this.options.autoCommit?this.options.asynchronous?(this._future||(this._future=setTimeout(r.commit.bind(r,null),0)),this):this.commit():this},n.prototype.commit=function(){var t=a(this.data,this._transaction,this.options);return this.data=t.data,this._transaction={},this._future&&(this._future=clearTimeout(this._future)),this.emit("update",{log:t.log}),this},n.prototype.release=function(){delete this.data,delete this._transaction;for(var t in this._cursors)this._cursors[t].release();delete this._cursors,this.kill()},n.prototype.toJSON=function(){return this.get()},r.exports=n},{"../defaults.js":1,"./cursor.js":6,"./helpers.js":7,"./merge.js":8,"./mixins.js":9,"./type.js":10,"./update.js":11,emmett:3}],5:[function(t,r){function e(t,r){r.on("update",t.cursorListener),t.tree.off("update",t.treeListener),t.tree.on("update",t.treeListener)}function n(t){var r=this;if(arguments.length<2)throw Error("baobab.Combination: not enough arguments.");var n=arguments[1],i=s.arrayOf(arguments).slice(2);if(n instanceof Array&&(i=n.slice(1),n=n[0]),!a.Cursor(n))throw Error("baobab.Combination: argument should be a cursor.");if("or"!==t&&"and"!==t)throw Error("baobab.Combination: invalid operator.");o.call(this),this.cursors=[n],this.operators=[],this.tree=n.tree,this.updates=new Array(this.cursors.length),this.cursorListener=function(){r.updates[r.cursors.indexOf(this)]=!0},this.treeListener=function(){var t,e,n=r.updates[0];for(t=1,e=r.cursors.length;e>t;t++)n="or"===r.operators[t-1]?n||r.updates[t]:n&&r.updates[t];n&&r.emit("update"),r.updates=new Array(r.cursors.length)},this.bound=!1;var h=(this.on,this.once,function(){r.bound||(r.bound=!0,r.cursors.forEach(function(t){e(r,t)}))});this.on=s.before(h,this.on.bind(this)),this.once=s.before(h,this.once.bind(this)),i.forEach(function(r){this[t](r)},this)}function i(t){n.prototype[t]=function(r){if(!a.Cursor(r))throw this.release(),Error("baobab.Combination."+t+": argument should be a cursor.");if(~this.cursors.indexOf(r))throw this.release(),Error("baobab.Combination."+t+": cursor already in combination.");return this.cursors.push(r),this.operators.push(t),this.updates.length++,this.bound&&e(this,r),this}}var o=t("emmett"),s=t("./helpers.js"),a=t("./type.js");s.inherits(n,o),i("or"),i("and"),n.prototype.release=function(){this.cursors.forEach(function(t){t.off("update",this.cursorListener)},this),this.tree.off("update",this.treeListener),this.cursors=null,this.operators=null,this.tree=null,this.updates=null,this.kill()},r.exports=n},{"./helpers.js":7,"./type.js":10,emmett:3}],6:[function(t,r){function e(t,r,e,n){var i=this;o.call(this),r=r||[],this.tree=t,this.path=r,this.hash=n,this.complexPath=!!e,this.solvedPath=this.complexPath?e:this.path,this.relevant=void 0!==this.get(),this.updateHandler=function(t){var r,e,n,o,s,a,u=t.data.log,c=!1;if(i.complexPath&&(i.solvedPath=h.solvePath(i.tree.data,i.path)),!i.path.length)return i.emit("update");t:for(s=0,n=u.length;n>s;s++)for(r=u[s],a=0,o=r.length;o>a&&(e=r[a],e===""+i.solvedPath[a]);a++)if(a+1===o||a+1===i.solvedPath.length){c=!0;break t}var l=void 0!==i.get();i.relevant?l&&c?i.emit("update"):l||(i.emit("irrelevant"),i.relevant=!1):l&&c&&(i.emit("relevant"),i.emit("update"),i.relevant=!0)},this.mixin=a.cursor(this);var s=!1,u=function(){s||(s=!0,i.tree.on("update",i.updateHandler))};this.on=h.before(u,this.on.bind(this)),this.once=h.before(u,this.once.bind(this))}function n(t,r,e,n){arguments.length<4&&(n=e,e=[]),e=e||[];var i=[].concat(e),o=h.solvePath(this.get(),i);if(!o)throw Error("baobab.Cursor."+t+": could not solve dynamic path.");if(r){var s=this.get(o);if(!u[r](s))throw Error("baobab.Cursor."+t+": invalid target.")}var a={};a["$"+t]=n;var c=h.pathObject(o,a);return c}function i(t,r){e.prototype[t]=function(){var e=n.bind(this,t,r).apply(this,arguments);return this.update(e)}}var o=t("emmett"),s=t("./combination.js"),a=t("./mixins.js"),h=t("./helpers.js"),u=t("./type.js");h.inherits(e,o),e.prototype.isRoot=function(){return!this.path.length},e.prototype.isLeaf=function(){return u.Primitive(this.get())},e.prototype.isBranch=function(){return!this.isLeaf()&&!this.isRoot()},e.prototype.root=function(){return this.tree.root()},e.prototype.select=function(t){if(arguments.length>1&&(t=h.arrayOf(arguments)),!u.Path(t))throw Error("baobab.Cursor.select: invalid path.");return this.tree.select(this.path.concat(t))},e.prototype.up=function(){return this.solvedPath&&this.solvedPath.length?this.tree.select(this.path.slice(0,-1)):null},e.prototype.left=function(){var t=+this.solvedPath[this.solvedPath.length-1];if(isNaN(t))throw Error("baobab.Cursor.left: cannot go left on a non-list type.");return t?this.tree.select(this.solvedPath.slice(0,-1).concat(t-1)):null},e.prototype.leftmost=function(){var t=+this.solvedPath[this.solvedPath.length-1];if(isNaN(t))throw Error("baobab.Cursor.leftmost: cannot go left on a non-list type.");return this.tree.select(this.solvedPath.slice(0,-1).concat(0))},e.prototype.right=function(){var t=+this.solvedPath[this.solvedPath.length-1];if(isNaN(t))throw Error("baobab.Cursor.right: cannot go right on a non-list type.");return t+1===this.up().get().length?null:this.tree.select(this.solvedPath.slice(0,-1).concat(t+1))},e.prototype.rightmost=function(){var t=+this.solvedPath[this.solvedPath.length-1];if(isNaN(t))throw Error("baobab.Cursor.right: cannot go right on a non-list type.");var r=this.up().get();return this.tree.select(this.solvedPath.slice(0,-1).concat(r.length-1))},e.prototype.down=function(){+this.solvedPath[this.solvedPath.length-1];return this.get()instanceof Array?this.tree.select(this.solvedPath.concat(0)):null},e.prototype.get=function(t){arguments.length>1&&(t=h.arrayOf(arguments));var r=this.solvedPath.concat((u.String(t)||u.Number(t)?[t]:t)||[]);return h.getIn(this.tree.data,r,this.tree)},i("set"),i("apply"),i("chain"),i("push","Array"),i("unshift","Array"),e.prototype.merge=function(t){if(!u.Object(t))throw Error("baobab.Cursor.merge: trying to merge a non-object.");var r=n.bind(this,"merge","Object").apply(this,arguments);return this.update(r)},e.prototype.unset=function(t){if(void 0===t&&this.isRoot())throw Error("baobab.Cursor.unset: cannot remove root node.");var r=n.bind(this,"unset",null).apply(this,[t,!0]);return this.update(r)},e.prototype.update=function(t,r){if(arguments.length<2)return this.tree.stack(h.pathObject(this.solvedPath,t)),this;var e=[].concat(t),n=h.solvePath(this.get(),e);if(!n)throw Error("baobab.Cursor.update: could not solve dynamic path.");return this.tree.stack(h.pathObject(this.solvedPath.concat(n),r)),this},e.prototype.or=function(t){return new s("or",this,t)},e.prototype.and=function(t){return new s("and",this,t)},e.prototype.release=function(){this.tree.off("update",this.updateHandler),this.hash&&delete this.tree._cursors[this.hash],delete this.tree,delete this.path,delete this.solvedPath,this.kill()},e.prototype.toJSON=function(){return this.get()},u.Cursor=function(t){return t instanceof e},r.exports=e},{"./combination.js":5,"./helpers.js":7,"./mixins.js":9,"./type.js":10,emmett:3}],7:[function(t,r){(function(e){function n(t){return Array.prototype.slice.call(t)}function i(t,r){return function(){t(),r.apply(null,arguments)}}function o(t,r){var e,n={};for(e in t)n[e]=t[e];for(e in r)n[e]=r[e];return n}function s(t){var r=t.source,e="";return t.global&&(e+="g"),t.multiline&&(e+="m"),t.ignoreCase&&(e+="i"),t.sticky&&(e+="y"),t.unicode&&(e+="u"),new RegExp(r,e)}function a(t,r){if(!r||"object"!=typeof r||r instanceof Error||"ArrayBuffer"in e&&r instanceof ArrayBuffer)return r;if(m.Array(r)){if(t){var n,i,o=[];for(n=0,i=r.length;i>n;n++)o.push(_(r[n]));return o}return r.slice(0)}if(m.Date(r))return new Date(r.getTime());if(r instanceof RegExp)return s(r);if(m.Object(r)){var a,h={};r.constructor&&r.constructor!==Object&&(h=Object.create(r.constructor.prototype));for(a in r)r.hasOwnProperty(a)&&(h[a]=t?_(r[a]):r[a]);return h}return r}function h(t,r){return function(e){return r(t(e))}}function u(t,r){var e,n;for(e=0,n=t.length;n>e;e++)if(r(t[e]))return t[e]}function c(t,r){var e,n;for(e=0,n=t.length;n>e;e++)if(r(t[e]))return e;return-1}function l(t,r){var e,n=!0;if(!t)return!1;for(e in r)if(m.Object(r[e]))n=n&&l(t[e],r[e]);else if(m.Array(r[e]))n=n&&!!~r[e].indexOf(t[e]);else if(t[e]!==r[e])return!1;return n}function f(t,r){return u(t,function(t){return l(t,r)})}function p(t,r){return c(t,function(t){return l(t,r)})}function d(t,r,e){r=r||[];var n,i,o,s=t;for(i=0,o=r.length;o>i;i++){if(!s)return;if("function"==typeof r[i]){if(!m.Array(s))return;s=u(s,r[i])}else if("object"==typeof r[i])if("$cursor"in r[i]){if(!m.Path(r[i].$cursor))throw Error("baobab.getIn: $cursor path must be an array.");n=e.get(r[i].$cursor),s=s[n]}else{if(!m.Array(s))return;s=f(s,r[i])}else s=s[r[i]]}return s}function b(t,r){var e,n,i,o=[],s=t;for(n=0,i=r.length;i>n;n++){if(!s)return null;if("function"==typeof r[n]){if(!m.Array(s))return;e=c(s,r[n]),o.push(e),s=s[e]}else if("object"==typeof r[n]){if(!m.Array(s))return;e=p(s,r[n]),o.push(e),s=s[e]}else o.push(r[n]),s=s[r[n]]||{}}return o}function y(t,r){var e,n=t.length,i={},o=i;for(n||(i=r),e=0;n>e;e++)o[t[e]]=e+1===n?r:{},o=o[t[e]];return i}function g(t,r){t.super_=r;var e=function(){};e.prototype=r.prototype,t.prototype=new e,t.prototype.constructor=t}var m=t("./type.js"),v=a.bind(null,!1),_=a.bind(null,!0);r.exports={arrayOf:n,before:i,deepClone:_,shallowClone:v,shallowMerge:o,compose:h,getIn:d,inherits:g,pathObject:y,solvePath:b}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./type.js":10}],8:[function(t,r){function e(t,r,e){s.forEach(function(r){e!==r&&delete t[r]}),t[e]=r[e]}function n(t,r){var a,h=i.shallowClone(r||{});s.forEach(function(r){t[r]&&e(h,t,r)}),t.$chain&&(s.slice(0,-1).forEach(function(t){delete h[t]}),h.$apply=h.$apply?i.compose(h.$apply,t.$chain):t.$chain),t.$push&&h.$push?h.$push=o.Array(h.$push)?h.$push.concat(t.$push):[h.$push].concat(t.$push):t.$push&&(h.$push=t.$push),t.$unshift&&h.$unshift?h.$unshift=o.Array(t.$unshift)?t.$unshift.concat(h.$unshift):[t.$unshift].concat(h.$unshift):t.$unshift&&(h.$unshift=t.$unshift);for(a in t)o.Object(t[a])?h[a]=n(t[a],h[a]):"$"!==a[0]&&(h[a]=t[a]);return h}var i=t("./helpers.js"),o=t("./type.js"),s=["$unset","$set","$merge","$apply"];r.exports=n},{"./helpers.js":7,"./type.js":10}],9:[function(t,r){var e=t("./combination.js"),n=t("./type.js");r.exports={baobab:function(t){return{mixins:[{getInitialState:function(){if(this.tree=t,!this.cursor&&!this.cursors)return{};if(this.cursor&&this.cursors)throw Error("baobab.mixin: you cannot have both `component.cursor` and `component.cursors`. Please make up your mind.");if(this.__type=null,this.__updateHandler=function(){this.setState(this.__getCursorData())}.bind(this),this.cursor){if(!n.MixinCursor(this.cursor))throw Error("baobab.mixin.cursor: invalid data (cursor, string, array or function).");n.Function(this.cursor)&&(this.cursor=this.cursor()),n.Cursor(this.cursor)||(this.cursor=t.select(this.cursor)),this.__getCursorData=function(){return{cursor:this.cursor.get()}}.bind(this),this.__type="single"}else if(this.cursors){if(!n.MixinCursors(this.cursors))throw Error("baobab.mixin.cursor: invalid data (object, array or function).");if(n.Function(this.cursors)&&(this.cursors=this.cursors()),n.Array(this.cursors))this.cursors=this.cursors.map(function(r){return n.Cursor(r)?r:t.select(r)}),this.__getCursorData=function(){return{cursors:this.cursors.map(function(t){return t.get()})}}.bind(this),this.__type="array";else{for(var r in this.cursors)n.Cursor(this.cursors[r])||(this.cursors[r]=t.select(this.cursors[r]));this.__getCursorData=function(){var t={};for(r in this.cursors)t[r]=this.cursors[r].get();return{cursors:t}}.bind(this),this.__type="object"}}return this.__getCursorData()},componentDidMount:function(){"single"===this.__type?(this.__combination=new e("or",[this.cursor]),this.__combination.on("update",this.__updateHandler)):"array"===this.__type?(this.__combination=new e("or",this.cursors),this.__combination.on("update",this.__updateHandler)):"object"===this.__type&&(this.__combination=new e("or",Object.keys(this.cursors).map(function(t){return this.cursors[t]},this)),this.__combination.on("update",this.__updateHandler))},componentWillUnmount:function(){this.__combination&&this.__combination.release()}}].concat(t.options.mixins)}},cursor:function(t){return{mixins:[{getInitialState:function(){return this.cursor=t,this.__updateHandler=function(){this.setState({cursor:this.cursor.get()})}.bind(this),{cursor:this.cursor.get()}},componentDidMount:function(){this.cursor.on("update",this.__updateHandler)},componentWillUnmount:function(){this.cursor.off("update",this.__updateHandler)}}].concat(t.tree.options.mixins)}}}},{"./combination.js":5,"./type.js":10}],10:[function(t,r){function e(t,r){return r.some(function(r){return n[r](t)})}var n={};n.Array=function(t){return Array.isArray(t)},n.Object=function(t){return!Array.isArray(t)&&"object"==typeof t&&null!==t},n.String=function(t){return"string"==typeof t},n.Number=function(t){return"number"==typeof t},n.Function=function(t){return"function"==typeof t},n.Primitive=function(t){return"string"==typeof t||"number"==typeof t||"boolean"==typeof t},n.Date=function(t){return t instanceof Date},n.NonScalar=function(t){return n.Object(t)||n.Array(t)},n.Path=function(t){var r=["String","Number","Function","Object"];return n.Array(t)?t.every(function(t){return e(t,r)}):e(t,r)},n.MixinCursor=function(t){return e(t,["String","Number","Array","Function","Cursor"])},n.MixinCursors=function(t){return e(t,["Object","Array","Function"])},n.ComplexPath=function(t){return e(t,["Object","Function"])},r.exports=n},{}],11:[function(t,r){function e(t,r){var e=new Error("baobab.update: "+r+" at path /"+t.slice(1).join("/"));return e.path=t,e}var n=t("./helpers.js"),i=t("./type.js");r.exports=function(t,r,o){if(o=o||{},!i.Object(t)&&!i.Array(t))throw Error("baobab.update: invalid target.");var s={};t={root:n.shallowClone(t)};var a=function(t,r,o,h){o=o||["root"];var u,c,l,f=o.join("λ"),p=o[o.length-1],d=Object.keys(r).some(function(t){return!!~["$unset","$set","$apply","$merge","$push","$unshift"].indexOf(t)});if(d){s[f]=!0;for(c in r){if("$unset"===c){var b=o[o.length-2];i.Array(t)?h[b]=t.slice(0,+p).concat(t.slice(+p+1)):(h[b]=n.shallowClone(t),delete h[b][p]);break}if("$set"===c){l=r.$set,t[p]=l;break}if("$apply"===c){if(u=r.$apply,"function"!=typeof u)throw e(o,"using command $apply with a non function");t[p]=u.call(null,t[p]);break}if("$merge"===c){if(l=r.$merge,!i.Object(t[p])||!i.Object(l))throw e(o,"using command $merge with a non object");t[p]=n.shallowMerge(t[p],l);break}if("$push"===c){if(l=r.$push,!i.Array(t[p]))throw e(o,"using command $push to a non array");t[p]=t[p].concat(l)}if("$unshift"===c){if(l=r.$unshift,!i.Array(t[p]))throw e(o,"using command $unshift to a non array");t[p]=[].concat(l).concat(t[p])}}}else for(c in r)t[p][c]="undefined"==typeof t[p][c]?{}:n.shallowClone(t[p][c]),a(t[p],r[c],o.concat(c),t)};return a(t,r),{data:t.root,log:Object.keys(s).map(function(t){return t.split("λ").slice(1)})}}},{"./helpers.js":7,"./type.js":10}]},{},[2])(2)});