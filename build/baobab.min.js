/*
 * Baobab
 *
 * Homepage: https://github.com/Yomguithereal/baobab
 * Version: 2.6.2
 * Author: Yomguithereal (Guillaume Plique)
 * License: MIT
 */
!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Baobab=t()}}((function(){return function t(e,r,n){function i(o,s){if(!r[o]){if(!e[o]){var u="function"==typeof require&&require;if(!s&&u)return u(o,!0);if(a)return a(o,!0);var h=new Error("Cannot find module '"+o+"'");throw h.code="MODULE_NOT_FOUND",h}var l=r[o]={exports:{}};e[o][0].call(l.exports,(function(t){return i(e[o][1][t]||t)}),l,l.exports,t,e,r,n)}return r[o].exports}for(var a="function"==typeof require&&require,o=0;o<n.length;o++)i(n[o]);return i}({1:[function(t,e,r){var n={once:"boolean",scope:"object"},i=0;function a(t,e){var r,n={};for(r in t)n[r]=t[r];for(r in e)n[r]=e[r];return n}function o(t){return t&&"object"==typeof t&&!Array.isArray(t)&&!(t instanceof Function)&&!(t instanceof RegExp)}function s(t,e,r){var n,i,a,o;for(i in t)e.call(r||null,i,t[i]);if(Object.getOwnPropertySymbols)for(a=0,o=(n=Object.getOwnPropertySymbols(t)).length;a<o;a++)e.call(r||null,n[a],t[n[a]])}var u=function(){this._enabled=!0,this.unbindAll()};function h(t,e){var r,n,i=[];for(n=0,r=(t=t||[]).length;n<r;n++)t[n].fn!==e&&i.push(t[n]);return i}u.prototype.unbindAll=function(){return this._handlers={},this._handlersAll=[],this._handlersComplex=[],this},u.prototype.on=function(t,e,r){var a,u,h,l,c,f,d;if(o(t))return s(t,(function(t,r){this.on(t,r,e)}),this),this;for("function"==typeof t&&(r=e,e=t,t=null),a=0,u=(c=[].concat(t)).length;a<u;a++){if(l=c[a],d={order:i++,fn:e},"string"==typeof l||"symbol"==typeof l)this._handlers[l]||(this._handlers[l]=[]),f=this._handlers[l],d.type=l;else if(l instanceof RegExp)f=this._handlersComplex,d.pattern=l;else{if(null!==l)throw Error("Emitter.on: invalid event.");f=this._handlersAll}for(h in r||{})n[h]&&(d[h]=r[h]);f.push(d)}return this},u.prototype.once=function(){var t=Array.prototype.slice.call(arguments),e=t.length-1;return o(t[e])&&t.length>1?t[e]=a(t[e],{once:!0}):t.push({once:!0}),this.on.apply(this,t)},u.prototype.off=function(t,e){var r,n,i,a;if(1===arguments.length&&"function"==typeof t){e=arguments[0];var u=Object.keys(this._handlers).concat(Object.getOwnPropertySymbols(this._handlers));for(r=0;r<u.length;r++)i=u[r],this._handlers[i]=h(this._handlers[i],e),0===this._handlers[i].length&&delete this._handlers[i];this._handlersAll=h(this._handlersAll,e),this._handlersComplex=h(this._handlersComplex,e)}else if(1!==arguments.length||"string"!=typeof t&&"symbol"!=typeof t)if(2===arguments.length){var l=[].concat(t);for(r=0,n=l.length;r<n;r++)a=l[r],this._handlers[a]=h(this._handlers[a],e),0===(this._handlers[a]||[]).length&&delete this._handlers[a]}else o(t)&&s(t,this.off,this);else delete this._handlers[t];return this},u.prototype.listeners=function(t){var e,r,n,i=this._handlersAll||[],a=!1;if(!t)throw Error("Emitter.listeners: no event provided.");for(i=i.concat(this._handlers[t]||[]),r=0,n=this._handlersComplex.length;r<n;r++)e=this._handlersComplex[r],"string"==typeof t&&~t.search(e.pattern)&&(a=!0,i.push(e));return this._handlersAll.length||a?i.sort((function(t,e){return t.order-e.order})):i.slice(0)},u.prototype.emit=function(t,e){if(!this._enabled)return this;if(o(t))return s(t,this.emit,this),this;var r,n,i,a,u,h,l,c,f=[].concat(t),d=[];for(u=0,l=f.length;u<l;u++){for(h=0,c=(i=this.listeners(f[u])).length;h<c;h++)a=i[h],r={type:f[u],target:this},arguments.length>1&&(r.data=e),a.fn.call("scope"in a?a.scope:this,r),a.once&&d.push(a);for(h=d.length-1;h>=0;h--){var p=(n=d[h].type?this._handlers[d[h].type]:d[h].pattern?this._handlersComplex:this._handlersAll).indexOf(d[h]);-1!==p&&n.splice(p,1)}}return this},u.prototype.kill=function(){this.unbindAll(),this._handlers=null,this._handlersAll=null,this._handlersComplex=null,this._enabled=!1,this.unbindAll=this.on=this.once=this.off=this.emit=this.listeners=Function.prototype},u.prototype.disable=function(){return this._enabled=!1,this},u.prototype.enable=function(){return this._enabled=!0,this},u.version="3.2.0",e.exports=u},{}],2:[function(t,e,r){"use strict";r.__esModule=!0,r.monkey=r.helpers=r.dynamic=r.default=r.VERSION=void 0;var n=c(t("emmett")),i=c(t("./cursor"));r.Cursor=i.default;var a=t("./monkey");r.MonkeyDefinition=a.MonkeyDefinition,r.Monkey=a.Monkey;var o=c(t("./watcher")),s=c(t("./type"));r.type=s.default;var u=c(t("./update")),h=function(t,e){if(!e&&t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var r=l(e);if(r&&r.has(t))return r.get(t);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in t)if("default"!==a&&Object.prototype.hasOwnProperty.call(t,a)){var o=i?Object.getOwnPropertyDescriptor(t,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=t[a]}n.default=t,r&&r.set(t,n);return n}(t("./helpers"));function l(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,r=new WeakMap;return(l=function(t){return t?r:e})(t)}function c(t){return t&&t.__esModule?t:{default:t}}function f(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function d(t,e){return(d=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}r.helpers=h;var p=h.arrayFrom,y=h.coercePath,v=h.deepFreeze,g=h.getIn,m=h.makeError,b=h.deepClone,_=h.deepMerge,k=h.shallowClone,w=h.shallowMerge,P=h.hashPath,j={autoCommit:!0,asynchronous:!0,immutable:!0,lazyMonkeys:!0,monkeyBusiness:!0,persistent:!0,pure:!0,validate:null,validationBehavior:"rollback"},M=function(t){var e,r;function n(e,r){var n;if(n=t.call(this)||this,arguments.length<1&&(e={}),!s.default.object(e)&&!s.default.array(e))throw m("Baobab: invalid data.",{data:e});n.options=w({},j,r),n.options.persistent||(n.options.immutable=!1,n.options.pure=!1),n._identity="[object Baobab]",n._cursors={},n._future=null,n._transaction=[],n._affectedPathsIndex={},n._monkeys={},n._previousData=null,n._data=e,n.root=new i.default(f(n),[],"λ"),delete n.root.release,n.options.immutable&&v(n._data);var a=function(t){n[t]=function(){var e=this.root[t].apply(this.root,arguments);return e instanceof i.default?this:e}};["apply","clone","concat","deepClone","deepMerge","exists","get","push","merge","pop","project","serialize","set","shift","splice","unset","unshift"].forEach(a),n.options.monkeyBusiness&&n._refreshMonkeys();var o=n.validate();if(o)throw Error("Baobab: invalid data.",{error:o});return n}r=t,(e=n).prototype=Object.create(r.prototype),e.prototype.constructor=e,d(e,r);var h=n.prototype;return h._refreshMonkeys=function(t,e,r){var n=this,i=function t(e,r){if(void 0===r&&(r=[]),e instanceof a.Monkey)return e.release(),void(0,u.default)(n._monkeys,r,{type:"unset"},{immutable:!1,persistent:!1,pure:!1});if(s.default.object(e))for(var i in e)t(e[i],r.concat(i))},o=function t(e,r){if(void 0===r&&(r=[]),e instanceof a.MonkeyDefinition||e instanceof a.Monkey){var i=new a.Monkey(n,r,e instanceof a.Monkey?e.definition:e);(0,u.default)(n._monkeys,r,{type:"set",value:i},{immutable:!1,persistent:!1,pure:!1})}else if(s.default.object(e))for(var o in e)t(e[o],r.concat(o))};if(arguments.length){var h=g(this._monkeys,e).data;h&&i(h,e),"unset"!==r&&o(t,e)}else o(this._data);return this},h.validate=function(t){var e=this.options,r=e.validate,n=e.validationBehavior;if("function"!=typeof r)return null;var i=r.call(this,this._previousData,this._data,t||[[]]);return i instanceof Error?("rollback"===n&&(this._data=this._previousData,this._affectedPathsIndex={},this._transaction=[],this._previousData=this._data),this.emit("invalid",{error:i}),i):null},h.select=function(t){if(t=t||[],arguments.length>1&&(t=p(arguments)),!s.default.path(t))throw m("Baobab.select: invalid path.",{path:t});t=[].concat(t);var e=P(t),r=this._cursors[e];return r||(r=new i.default(this,t,e),this._cursors[e]=r),this.emit("select",{path:t,cursor:r}),r},h.update=function(t,e){var r=this;if(t=y(t),!s.default.operationType(e.type))throw m('Baobab.update: unknown operation type "'+e.type+'".',{operation:e});var n=g(this._data,t),i=n.solvedPath,a=n.exists;if(!i)throw m("Baobab.update: could not solve the given path.",{path:i});var o=s.default.monkeyPath(this._monkeys,i);if(o&&i.length>o.length)throw m("Baobab.update: attempting to update a read-only path.",{path:i});if("unset"!==e.type||a){var h=e;if(/merge/i.test(e.type)){var l=g(this._monkeys,i).data;if(s.default.object(l)){h=k(h);var c=g(this._data,i).data;/deep/i.test(h.type)?h.value=_({},_({},c,b(l)),h.value):h.value=w({},_({},c,b(l)),h.value)}}this._transaction.length||(this._previousData=this._data);var f=(0,u.default)(this._data,i,h,this.options),d=f.data,p=f.node;if(!("data"in f))return p;var v=i.concat("push"===e.type?p.length-1:[]),j=P(v);return this._data=d,this._affectedPathsIndex[j]=!0,this._transaction.push(w({},e,{path:v})),this.options.monkeyBusiness&&this._refreshMonkeys(p,i,e.type),this.emit("write",{path:v}),this.options.autoCommit?this.options.asynchronous?(this._future||(this._future=setTimeout((function(){return r.commit()}),0)),p):(this.commit(),p):p}},h.commit=function(){if(!this._transaction.length)return this;this._future&&(this._future=clearTimeout(this._future));var t=Object.keys(this._affectedPathsIndex).map((function(t){return"λ"!==t?t.split("λ").slice(1):[]}));if(this.validate(t))return this;var e=this._transaction,r=this._previousData;return this._affectedPathsIndex={},this._transaction=[],this._previousData=this._data,this.emit("update",{paths:t,currentData:this._data,transaction:e,previousData:r}),this},h.getMonkey=function(t){t=y(t);var e=g(this._monkeys,[].concat(t)).data;return e instanceof a.Monkey?e:null},h.watch=function(t){return new o.default(this,t)},h.release=function(){var t;for(t in this.emit("release"),delete this.root,delete this._data,delete this._previousData,delete this._transaction,delete this._affectedPathsIndex,delete this._monkeys,this._cursors)this._cursors[t].release();delete this._cursors,this.kill()},h.toJSON=function(){return this.serialize()},h.toString=function(){return this._identity},n}(n.default);M.monkey=function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];if(!e.length)throw new Error("Baobab.monkey: missing definition.");return 1===e.length&&"function"!=typeof e[0]?new a.MonkeyDefinition(e[0]):new a.MonkeyDefinition(e)},M.dynamicNode=M.monkey;var O=M.monkey;r.monkey=O;var C=M.dynamic;r.dynamic=C,M.VERSION="2.6.1";var E=M.VERSION;r.VERSION=E;var x=M;r.default=x},{"./cursor":3,"./helpers":4,"./monkey":5,"./type":6,"./update":7,"./watcher":8,emmett:1}],3:[function(t,e,r){"use strict";r.__esModule=!0,r.default=void 0;var n=s(t("emmett")),i=t("./monkey"),a=s(t("./type")),o=t("./helpers");function s(t){return t&&t.__esModule?t:{default:t}}function u(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function h(t,e){return(h=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function l(t,e){if(!e)throw(0,o.makeError)("Baobab.Cursor."+t+": cannot use "+t+" on an unresolved dynamic path.",{path:e})}var c=function(t){var e,r;function n(e,r,n){var i;r=r||[],(i=t.call(this)||this)._identity="[object Cursor]",i._archive=null,i.tree=e,i.path=r,i.hash=n,i.state={killed:!1,recording:!1,undoing:!1},i._dynamicPath=a.default.dynamicPath(i.path),i._monkeyPath=a.default.monkeyPath(i.tree._monkeys,i.path),i._dynamicPath?i.solvedPath=(0,o.getIn)(i.tree._data,i.path).solvedPath:i.solvedPath=i.path,i._writeHandler=function(t){var e=t.data;!i.state.killed&&(0,o.solveUpdate)([e.path],i._getComparedPaths())&&(i.solvedPath=(0,o.getIn)(i.tree._data,i.path).solvedPath)};var s=function(t){var e=u(i),r={get previousData(){return(0,o.getIn)(t,e.solvedPath).data},get currentData(){return e.get()}};return i.state.recording&&!i.state.undoing&&i.archive.add(r.previousData),i.state.undoing=!1,i.emit("update",r)};i._updateHandler=function(t){if(!i.state.killed){var e=t.data,r=e.paths,n=e.previousData,a=s.bind(u(i),n),h=i._getComparedPaths();return(0,o.solveUpdate)(r,h)?a():void 0}};var h=!1;return i._lazyBind=function(){if(!h)return h=!0,i._dynamicPath&&i.tree.on("write",i._writeHandler),i.tree.on("update",i._updateHandler)},i._dynamicPath?i._lazyBind():(i.on=(0,o.before)(i._lazyBind,i.on.bind(u(i))),i.once=(0,o.before)(i._lazyBind,i.once.bind(u(i)))),i}r=t,(e=n).prototype=Object.create(r.prototype),e.prototype.constructor=e,h(e,r);var s=n.prototype;return s._getComparedPaths=function(){var t=this._monkeyPath?(0,o.getIn)(this.tree._monkeys,this._monkeyPath).data.relatedPaths():[];return[this.solvedPath].concat(t)},s.isRoot=function(){return!this.path.length},s.isLeaf=function(){return a.default.primitive(this._get().data)},s.isBranch=function(){return!this.isRoot()&&!this.isLeaf()},s.root=function(){return this.tree.select()},s.select=function(t){return arguments.length>1&&(t=(0,o.arrayFrom)(arguments)),this.tree.select(this.path.concat(t))},s.up=function(){return this.isRoot()?null:this.tree.select(this.path.slice(0,-1))},s.down=function(){if(l("down",this.solvedPath),!(this._get().data instanceof Array))throw Error("Baobab.Cursor.down: cannot go down on a non-list type.");return this.tree.select(this.solvedPath.concat(0))},s.left=function(){l("left",this.solvedPath);var t=+this.solvedPath[this.solvedPath.length-1];if(isNaN(t))throw Error("Baobab.Cursor.left: cannot go left on a non-list type.");return t?this.tree.select(this.solvedPath.slice(0,-1).concat(t-1)):null},s.right=function(){l("right",this.solvedPath);var t=+this.solvedPath[this.solvedPath.length-1];if(isNaN(t))throw Error("Baobab.Cursor.right: cannot go right on a non-list type.");return t+1===this.up()._get().data.length?null:this.tree.select(this.solvedPath.slice(0,-1).concat(t+1))},s.leftmost=function(){l("leftmost",this.solvedPath);var t=+this.solvedPath[this.solvedPath.length-1];if(isNaN(t))throw Error("Baobab.Cursor.leftmost: cannot go left on a non-list type.");return this.tree.select(this.solvedPath.slice(0,-1).concat(0))},s.rightmost=function(){l("rightmost",this.solvedPath);var t=+this.solvedPath[this.solvedPath.length-1];if(isNaN(t))throw Error("Baobab.Cursor.rightmost: cannot go right on a non-list type.");var e=this.up()._get().data;return this.tree.select(this.solvedPath.slice(0,-1).concat(e.length-1))},s.map=function(t,e){l("map",this.solvedPath);var r=this._get().data,n=arguments.length;if(!a.default.array(r))throw Error("baobab.Cursor.map: cannot map a non-list type.");return r.map((function(i,a){return t.call(n>1?e:this,this.select(a),a,r)}),this)},s._get=function(t){if(void 0===t&&(t=[]),!a.default.path(t))throw(0,o.makeError)("Baobab.Cursor.getters: invalid path.",{path:t});return this.solvedPath?(0,o.getIn)(this.tree._data,this.solvedPath.concat(t)):{data:void 0,solvedPath:null,exists:!1}},s.exists=function(t){return t=(0,o.coercePath)(t),arguments.length>1&&(t=(0,o.arrayFrom)(arguments)),this._get(t).exists},s.get=function(t){t=(0,o.coercePath)(t),arguments.length>1&&(t=(0,o.arrayFrom)(arguments));var e=this._get(t),r=e.data,n=e.solvedPath;return this.tree.emit("get",{data:r,solvedPath:n,path:this.path.concat(t)}),r},s.clone=function(){var t=this.get.apply(this,arguments);return(0,o.shallowClone)(t)},s.deepClone=function(){var t=this.get.apply(this,arguments);return(0,o.deepClone)(t)},s.serialize=function(t){if(t=(0,o.coercePath)(t),arguments.length>1&&(t=(0,o.arrayFrom)(arguments)),!a.default.path(t))throw(0,o.makeError)("Baobab.Cursor.getters: invalid path.",{path:t});if(this.solvedPath){var e=this.solvedPath.concat(t),r=(0,o.deepClone)((0,o.getIn)(this.tree._data,e).data),n=(0,o.getIn)(this.tree._monkeys,e).data,s=function t(e,r){if(a.default.object(r)&&a.default.object(e))for(var n in r)r[n]instanceof i.Monkey?delete e[n]:t(e[n],r[n])};return s(r,n),r}},s.project=function(t){if(a.default.object(t)){var e={};for(var r in t)e[r]=this.get(t[r]);return e}if(a.default.array(t)){for(var n=[],i=0,s=t.length;i<s;i++)n.push(this.get(t[i]));return n}throw(0,o.makeError)("Baobab.Cursor.project: wrong projection.",{projection:t})},s.startRecording=function(t){if((t=t||1/0)<1)throw(0,o.makeError)("Baobab.Cursor.startRecording: invalid max records.",{value:t});return this.state.recording=!0,this.archive||(this._lazyBind(),this.archive=new o.Archive(t)),this},s.stopRecording=function(){return this.state.recording=!1,this},s.undo=function(t){if(void 0===t&&(t=1),!this.state.recording)throw new Error("Baobab.Cursor.undo: cursor is not recording.");var e=this.archive.back(t);if(!e)throw Error("Baobab.Cursor.undo: cannot find a relevant record.");return this.state.undoing=!0,this.set(e),this},s.hasHistory=function(){return!(!this.archive||!this.archive.get().length)},s.getHistory=function(){return this.archive?this.archive.get():[]},s.clearHistory=function(){return this.archive&&this.archive.clear(),this},s.release=function(){this._dynamicPath&&this.tree.off("write",this._writeHandler),this.tree.off("update",this._updateHandler),this.hash&&delete this.tree._cursors[this.hash],delete this.tree,delete this.path,delete this.solvedPath,delete this.archive,this.kill(),this.state.killed=!0},s.toJSON=function(){return this.serialize()},s.toString=function(){return this._identity},n}(n.default);r.default=c,"function"==typeof Symbol&&void 0!==Symbol.iterator&&(c.prototype[Symbol.iterator]=function(){var t=this._get().data;if(!a.default.array(t))throw Error("baobab.Cursor.@@iterate: cannot iterate a non-list type.");var e=0,r=this,n=t.length;return{next:function(){return e<n?{value:r.select(e++)}:{done:!0}}}});var f={unset:!0,pop:!0,shift:!0};function d(t,e){c.prototype[t]=function(r,n){if(arguments.length>2)throw(0,o.makeError)("Baobab.Cursor."+t+": too many arguments.");if(1!==arguments.length||f[t]||(n=r,r=[]),r=(0,o.coercePath)(r),!a.default.path(r))throw(0,o.makeError)("Baobab.Cursor."+t+": invalid path.",{path:r});if(e&&!e(n))throw(0,o.makeError)("Baobab.Cursor."+t+": invalid value.",{path:r,value:n});if(!this.solvedPath)throw(0,o.makeError)("Baobab.Cursor."+t+": the dynamic path of the cursor cannot be solved.",{path:this.path});var i=this.solvedPath.concat(r);return this.tree.update(i,{type:t,value:n})}}d("set"),d("unset"),d("apply",a.default.function),d("push"),d("concat",a.default.array),d("unshift"),d("pop"),d("shift"),d("splice",a.default.splicer),d("merge",a.default.object),d("deepMerge",a.default.object)},{"./helpers":4,"./monkey":5,"./type":6,emmett:1}],4:[function(t,e,r){(function(e){(function(){"use strict";r.__esModule=!0,r.Archive=void 0,r.arrayFrom=function(t){return u(t)},r.before=function(t,e){return function(){t.apply(null,arguments),e.apply(null,arguments)}},r.coercePath=function(t){return t||0===t||""===t?t:[]},r.freeze=r.deepMerge=r.deepFreeze=r.deepClone=void 0,r.getIn=function(t,e){if(!e)return g;var r,n,i,o=[],u=!0,h=t;for(n=0,i=e.length;n<i;n++){if(!h)return{data:void 0,solvedPath:o.concat(e.slice(n)),exists:!1};if("function"==typeof e[n]){if(!a.default.array(h))return g;if(!~(r=s(h,e[n])))return g;o.push(r),h=h[r]}else if("object"==typeof e[n]){if(!a.default.array(h))return g;if(!~(r=s(h,(function(t){return d(t,e[n])}))))return g;o.push(r),h=h[r]}else o.push(e[n]),u="object"==typeof h&&e[n]in h,h=h[e[n]]}return{data:h,solvedPath:o,exists:u}},r.hashPath=function(t){return"λ"+t.map((function(t){return a.default.function(t)||a.default.object(t)?"#"+w()+"#":t})).join("λ")},r.makeError=function(t,e){var r=new Error(t);for(var n in e)r[n]=e[n];return r},r.shallowMerge=r.shallowClone=void 0,r.solveRelativePath=function(t,e){var r=[];e=[].concat(e);for(var n=0,i=e.length;n<i;n++){var a=e[n];"."===a?n||(r=t.slice(0)):".."===a?r=(n?r:t).slice(0,-1):r.push(a)}return r},r.solveUpdate=function(t,e){var r,n,i,a,o,s,u,h;for(r=0,a=t.length;r<a;r++){if(!(u=t[r]).length)return!0;for(n=0,o=e.length;n<o;n++){if(!(h=e[n])||!h.length)return!0;for(i=0,s=h.length;i<s&&h[i]==u[i];i++)if(i+1===s||i+1===u.length)return!0}}return!1},r.splice=function(t,e,r){for(var n=arguments.length,i=new Array(n>3?n-3:0),o=3;o<n;o++)i[o-3]=arguments[o];if(void 0===r&&2===arguments.length)r=t.length-e;else if(null==r)r=0;else if(isNaN(+r))throw new Error("argument nb "+r+" can not be parsed into a number!");r=Math.max(0,r),a.default.function(e)&&(e=s(t,e));a.default.object(e)&&(e=s(t,(function(t){return d(t,e)})));return e>=0?t.slice(0,e).concat(i).concat(t.slice(e+r)):t.slice(0,t.length+e).concat(i).concat(t.slice(t.length+e+r))},r.uniqid=void 0;var n,i=t("./monkey"),a=(n=t("./type"))&&n.__esModule?n:{default:n};var o={}.hasOwnProperty;function s(t,e){var r,n;for(r=0,n=t.length;r<n;r++)if(e(t[r]))return r;return-1}function u(t){var e,r,n=new Array(t.length);for(e=0,r=t.length;e<r;e++)n[e]=t[e];return n}var h=function(){function t(t){this.size=t,this.records=[]}var e=t.prototype;return e.get=function(){return this.records},e.add=function(t){return this.records.unshift(t),this.records.length>this.size&&(this.records.length=this.size),this},e.clear=function(){return this.records=[],this},e.back=function(t){var e=this.records[t-1];return e&&(this.records=this.records.slice(t)),e},t}();function l(t,r){if(!r||"object"!=typeof r||r instanceof Error||r instanceof i.MonkeyDefinition||r instanceof i.Monkey||"ArrayBuffer"in e&&r instanceof ArrayBuffer)return r;if(a.default.array(r)){if(t){for(var n=new Array(r.length),o=0,s=r.length;o<s;o++)n[o]=l(!0,r[o]);return n}return u(r)}if(r instanceof Date)return new Date(r.getTime());if(r instanceof RegExp)return c=(h=r).source,f="",h.global&&(f+="g"),h.multiline&&(f+="m"),h.ignoreCase&&(f+="i"),h.sticky&&(f+="y"),h.unicode&&(f+="u"),new RegExp(c,f);var h,c,f;if(a.default.object(r)){for(var d={},p=Object.getOwnPropertyNames(r),y=0,v=p.length;y<v;y++){var g=p[y],m=Object.getOwnPropertyDescriptor(r,g);!0===m.enumerable?m.get&&m.get.isLazyGetter?Object.defineProperty(d,g,{get:m.get,enumerable:!0,configurable:!0}):d[g]=t?l(!0,r[g]):r[g]:!1===m.enumerable&&Object.defineProperty(d,g,{value:t?l(!0,m.value):m.value,enumerable:!1,writable:!0,configurable:!0})}return d}return r}r.Archive=h;var c=l.bind(null,!1),f=l.bind(null,!0);function d(t,e){var r,n=!0;if(!t)return!1;for(r in e)if(a.default.object(e[r]))n=n&&d(t[r],e[r]);else if(a.default.array(e[r]))n=n&&!!~e[r].indexOf(t[r]);else if(t[r]!==e[r])return!1;return n}function p(t,e){var r,n,s,u;if(!("object"!=typeof e||null===e||e instanceof i.Monkey)&&(Object.freeze(e),t))if(Array.isArray(e))for(r=0,n=e.length;r<n;r++)v(e[r]);else for(u in e)a.default.lazyGetter(e,u)||(s=e[u])&&o.call(e,u)&&"object"==typeof s&&!Object.isFrozen(s)&&v(s)}r.deepClone=f,r.shallowClone=c;var y=p.bind(null,!1),v=p.bind(null,!0);r.deepFreeze=v,r.freeze=y;var g={data:void 0,solvedPath:null,exists:!1};function m(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];var o,s,u,h,l=r[0];for(s=1,u=r.length;s<u;s++)for(h in o=r[s])!t||!a.default.object(o[h])||o[h]instanceof i.Monkey||"__proto__"===h||"constructor"===h||"prototype"===h?l[h]=o[h]:l[h]=m(!0,l[h]||{},o[h]);return l}var b=m.bind(null,!1),_=m.bind(null,!0);r.deepMerge=_,r.shallowMerge=b;var k,w=(k=0,function(){return k++});r.uniqid=w}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./monkey":5,"./type":6}],5:[function(t,e,r){"use strict";r.__esModule=!0,r.MonkeyDefinition=r.Monkey=void 0;var n=o(t("./type")),i=o(t("./update")),a=t("./helpers");function o(t){return t&&t.__esModule?t:{default:t}}r.MonkeyDefinition=function(t){var e=this,r=n.default.monkeyDefinition(t);if(!r)throw(0,a.makeError)("Baobab.monkey: invalid definition.",{definition:t});if(this.type=r,"object"===this.type)this.getter=t.get,this.projection=t.cursors||{},this.paths=Object.keys(this.projection).map((function(t){return e.projection[t]})),this.options=t.options||{};else{var i=1,o={};n.default.object(t[t.length-1])&&(i++,o=t[t.length-1]),this.getter=t[t.length-i],this.projection=t.slice(0,-i),this.paths=this.projection,this.options=o}this.paths=this.paths.map((function(t){return[].concat(t)})),this.hasDynamicPaths=this.paths.some(n.default.dynamicPath)};var s=function(){function t(t,e,r){var n=this;this.tree=t,this.path=e,this.definition=r;var i=r.projection,o=a.solveRelativePath.bind(null,e.slice(0,-1));"object"===r.type?(this.projection=Object.keys(i).reduce((function(t,e){return t[e]=o(i[e]),t}),{}),this.depPaths=Object.keys(this.projection).map((function(t){return n.projection[t]}))):(this.projection=i.map(o),this.depPaths=this.projection),this.state={killed:!1},this.writeListener=function(t){var e=t.data.path;n.state.killed||(0,a.solveUpdate)([e],n.relatedPaths())&&n.update()},this.recursiveListener=function(t){var e=t.data,r=e.monkey,i=e.path;n.state.killed||n!==r&&(0,a.solveUpdate)([i],n.relatedPaths(!1))&&n.update()},this.tree.on("write",this.writeListener),this.tree.on("_monkey",this.recursiveListener),this.update()}var e=t.prototype;return e.relatedPaths=function(t){var e,r=this;return void 0===t&&(t=!0),e=this.definition.hasDynamicPaths?this.depPaths.map((function(t){return(0,a.getIn)(r.tree._data,t).solvedPath})):this.depPaths,t&&this.depPaths.some((function(t){return!!n.default.monkeyPath(r.tree._monkeys,t)}))?e.reduce((function(t,e){var i=n.default.monkeyPath(r.tree._monkeys,e);if(!i)return t.concat([e]);var o=(0,a.getIn)(r.tree._monkeys,i).data;return t.concat(o.relatedPaths())}),[]):e},e.update=function(){var t,e,r,n,o,s=this,u=this.tree.project(this.projection),h=(t=this.tree,e=this.definition,r=u,n=null,o=!1,function(){if(!o){n=e.getter.apply(t,"object"===e.type?[r]:r),t.options.immutable&&!1!==e.options.immutable&&(0,a.deepFreeze)(n);var i=(0,a.hashPath)(s.path);t._affectedPathsIndex[i]=!0,o=!0}return n});if(h.isLazyGetter=!0,this.tree.options.lazyMonkeys)this.tree._data=(0,i.default)(this.tree._data,this.path,{type:"monkey",value:h},this.tree.options).data;else{var l=(0,i.default)(this.tree._data,this.path,{type:"set",value:h(),options:{mutableLeaf:!this.definition.options.immutable}},this.tree.options);"data"in l&&(this.tree._data=l.data)}return this.tree.emit("_monkey",{monkey:this,path:this.path}),this},e.release=function(){this.tree.off("write",this.writeListener),this.tree.off("_monkey",this.recursiveListener),this.state.killed=!0,delete this.projection,delete this.depPaths,delete this.tree},t}();r.Monkey=s},{"./helpers":4,"./type":6,"./update":7}],6:[function(t,e,r){"use strict";r.__esModule=!0,r.default=void 0;var n=t("./monkey"),i={};function a(t,e){return e.some((function(e){return i[e](t)}))}i.array=function(t){return Array.isArray(t)},i.object=function(t){return t&&"object"==typeof t&&!Array.isArray(t)&&!(t instanceof Date)&&!(t instanceof RegExp)&&!("function"==typeof Map&&t instanceof Map)&&!("function"==typeof Set&&t instanceof Set)},i.string=function(t){return"string"==typeof t},i.number=function(t){return"number"==typeof t},i.function=function(t){return"function"==typeof t},i.primitive=function(t){return t!==Object(t)},i.splicer=function(t){return!(!i.array(t)||t.length<1)&&(!(t.length>1&&isNaN(+t[1]))&&a(t[0],["number","function","object"]))};var o=["string","number","function","object"];i.path=function(t){return!(!t&&0!==t&&""!==t)&&[].concat(t).every((function(t){return a(t,o)}))},i.dynamicPath=function(t){return t.some((function(t){return i.function(t)||i.object(t)}))},i.monkeyPath=function(t,e){var r,i,a=[],o=t;for(r=0,i=e.length;r<i;r++){if(a.push(e[r]),"object"!=typeof o)return null;if((o=o[e[r]])instanceof n.Monkey)return a}return null},i.lazyGetter=function(t,e){var r=Object.getOwnPropertyDescriptor(t,e);return r&&r.get&&!0===r.get.isLazyGetter},i.monkeyDefinition=function(t){if(i.object(t))return i.function(t.get)&&(!t.cursors||i.object(t.cursors)&&Object.keys(t.cursors).every((function(e){return i.path(t.cursors[e])})))?"object":null;if(i.array(t)){var e=1;return i.object(t[t.length-1])&&e++,i.function(t[t.length-e])&&t.slice(0,-e).every((function(t){return i.path(t)}))?"array":null}return null},i.watcherMapping=function(t){return i.object(t)&&Object.keys(t).every((function(e){return i.path(t[e])}))};var s=["set","apply","push","unshift","concat","pop","shift","deepMerge","merge","splice","unset"];i.operationType=function(t){return"string"==typeof t&&!!~s.indexOf(t)};var u=i;r.default=u},{"./monkey":5}],7:[function(t,e,r){"use strict";r.__esModule=!0,r.default=function(t,e,r,n){void 0===n&&(n={});var s,u,h,l=r.type,c=r.value,f=r.options,d=void 0===f?{}:f,p={root:t},y=["root"].concat(e),v=[],g=p;for(s=0,u=y.length;s<u;s++){if(h=y[s],s>0&&v.push(h),s===u-1){if("set"===l){if(n.pure&&g[h]===c)return{node:g[h]};i.default.lazyGetter(g,h)?Object.defineProperty(g,h,{value:c,enumerable:!0,configurable:!0}):n.persistent&&!d.mutableLeaf?g[h]=(0,a.shallowClone)(c):g[h]=c}else if("monkey"===l)Object.defineProperty(g,h,{get:c,enumerable:!0,configurable:!0});else if("apply"===l){var m=c(g[h]);if(n.pure&&g[h]===m)return{node:g[h]};i.default.lazyGetter(g,h)?Object.defineProperty(g,h,{value:m,enumerable:!0,configurable:!0}):n.persistent?g[h]=(0,a.shallowClone)(m):g[h]=m}else if("push"===l){if(!i.default.array(g[h]))throw o("push","array",v);n.persistent?g[h]=g[h].concat([c]):g[h].push(c)}else if("unshift"===l){if(!i.default.array(g[h]))throw o("unshift","array",v);n.persistent?g[h]=[c].concat(g[h]):g[h].unshift(c)}else if("concat"===l){if(!i.default.array(g[h]))throw o("concat","array",v);n.persistent?g[h]=g[h].concat(c):g[h].push.apply(g[h],c)}else if("splice"===l){if(!i.default.array(g[h]))throw o("splice","array",v);n.persistent?g[h]=a.splice.apply(null,[g[h]].concat(c)):g[h].splice.apply(g[h],c)}else if("pop"===l){if(!i.default.array(g[h]))throw o("pop","array",v);n.persistent?g[h]=(0,a.splice)(g[h],-1,1):g[h].pop()}else if("shift"===l){if(!i.default.array(g[h]))throw o("shift","array",v);n.persistent?g[h]=(0,a.splice)(g[h],0,1):g[h].shift()}else if("unset"===l)i.default.object(g)?delete g[h]:i.default.array(g)&&g.splice(h,1);else if("merge"===l){if(!i.default.object(g[h]))throw o("merge","object",v);n.persistent?g[h]=(0,a.shallowMerge)({},g[h],c):g[h]=(0,a.shallowMerge)(g[h],c)}else if("deepMerge"===l){if(!i.default.object(g[h]))throw o("deepMerge","object",v);n.persistent?g[h]=(0,a.deepMerge)({},g[h],c):g[h]=(0,a.deepMerge)(g[h],c)}n.immutable&&!d.mutableLeaf&&(0,a.deepFreeze)(g);break}i.default.primitive(g[h])?g[h]={}:n.persistent&&(g[h]=(0,a.shallowClone)(g[h])),n.immutable&&u>0&&(0,a.freeze)(g),g=g[h]}return i.default.lazyGetter(g,h)?{data:p.root}:{data:p.root,node:g[h]}};var n,i=(n=t("./type"))&&n.__esModule?n:{default:n},a=t("./helpers");function o(t,e,r){return(0,a.makeError)('Baobab.update: cannot apply the "'+t+'" on a non '+e+" (path: /"+r.join("/")+").",{path:r})}},{"./helpers":4,"./type":6}],8:[function(t,e,r){"use strict";r.__esModule=!0,r.default=void 0;var n=s(t("emmett")),i=s(t("./cursor")),a=s(t("./type")),o=t("./helpers");function s(t){return t&&t.__esModule?t:{default:t}}function u(t,e){return(u=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var h=function(t){var e,r;function n(e,r){var n;return(n=t.call(this)||this).tree=e,n.mapping=null,n.state={killed:!1},n.refresh(r),n.handler=function(t){if(!n.state.killed){var e=n.getWatchedPaths();return(0,o.solveUpdate)(t.data.paths,e)?n.emit("update"):void 0}},n.tree.on("update",n.handler),n}r=t,(e=n).prototype=Object.create(r.prototype),e.prototype.constructor=e,u(e,r);var s=n.prototype;return s.getWatchedPaths=function(){var t=this;return Object.keys(this.mapping).map((function(e){var r=t.mapping[e];return r instanceof i.default?r.solvedPath:t.mapping[e]})).reduce((function(e,r){if(r=[].concat(r),a.default.dynamicPath(r)&&(r=(0,o.getIn)(t.tree._data,r).solvedPath),!r)return e;var n=a.default.monkeyPath(t.tree._monkeys,r);return n?e.concat((0,o.getIn)(t.tree._monkeys,n).data.relatedPaths()):e.concat([r])}),[])},s.getCursors=function(){var t=this,e={};return Object.keys(this.mapping).forEach((function(r){var n=t.mapping[r];n instanceof i.default?e[r]=n:e[r]=t.tree.select(n)})),e},s.refresh=function(t){if(!a.default.watcherMapping(t))throw(0,o.makeError)("Baobab.watch: invalid mapping.",{mapping:t});this.mapping=t;var e={};for(var r in t)e[r]=t[r]instanceof i.default?t[r].path:t[r];this.get=this.tree.project.bind(this.tree,e)},s.release=function(){this.tree.off("update",this.handler),this.state.killed=!0,this.kill()},n}(n.default);r.default=h},{"./cursor":3,"./helpers":4,"./type":6,emmett:1}]},{},[2])(2)}));
