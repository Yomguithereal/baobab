/* baobab.js - Version: 1.0.0-rc1 - Author: Yomguithereal (Guillaume Plique) */
!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var r;r="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,r.Baobab=t()}}(function(){var t;return function r(t,e,n){function i(s,a){if(!e[s]){if(!t[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(o)return o(s,!0);var h=new Error("Cannot find module '"+s+"'");throw h.code="MODULE_NOT_FOUND",h}var c=e[s]={exports:{}};t[s][0].call(c.exports,function(r){var e=t[s][1][r];return i(e?e:r)},c,c.exports,r,t,e,n)}return e[s].exports}for(var o="function"==typeof require&&require,s=0;s<n.length;s++)i(n[s]);return i}({1:[function(t,r,e){var n=t("./src/baobab.js"),i=t("./src/helpers.js");Object.defineProperty(n,"version",{value:"1.0.0-rc1"}),n.getIn=i.getIn,r.exports=n},{"./src/baobab.js":4,"./src/helpers.js":7}],2:[function(t,r,e){r.exports={autoCommit:!0,asynchronous:!0,facets:{},mixins:[],validate:null}},{}],3:[function(r,e,n){(function(){"use strict";function r(t,r){var e,n={};for(e in t)n[e]=t[e];for(e in r)n[e]=r[e];return n}function i(t){return!(!t||"object"!=typeof t||Array.isArray(t)||t instanceof Function||t instanceof RegExp)}function o(t,r){t=t||[];var e,n,i=[];for(n=0,e=t.length;e>n;n++)t[n].fn!==r&&i.push(t[n]);return i}var s={once:"boolean",scope:"object"},a=0,u=function(){this._enabled=!0,this.unbindAll()};u.prototype.unbindAll=function(){return this._handlers={},this._handlersAll=[],this._handlersComplex=[],this},u.prototype.on=function(t,r,e){var n,o,u,h,c,l,f;if(i(t)){for(h in t)this.on(h,t[h],r);return this}for("function"==typeof t&&(e=r,r=t,t=null),c=[].concat(t),n=0,o=c.length;o>n;n++){if(h=c[n],f={order:a++,fn:r},"string"==typeof h)this._handlers[h]||(this._handlers[h]=[]),l=this._handlers[h];else if(h instanceof RegExp)l=this._handlersComplex,f.pattern=h;else{if(null!==h)throw Error("Emitter.on: invalid event.");l=this._handlersAll}for(u in e||{})s[u]&&(f[u]=e[u]);f.once&&(f.parent=l),l.push(f)}return this},u.prototype.once=function(){var t=Array.prototype.slice.call(arguments),e=t.length-1;return i(t[e])&&t.length>1?t[e]=r(t[e],{once:!0}):t.push({once:!0}),this.on.apply(this,t)},u.prototype.off=function(t,r){var e,n,s,a;if(1===arguments.length&&"function"==typeof t){r=arguments[0];for(s in this._handlers)this._handlers[s]=o(this._handlers[s],r),0===this._handlers[s].length&&delete this._handlers[s];this._handlersAll=o(this._handlersAll,r),this._handlersComplex=o(this._handlersComplex,r)}else if(1===arguments.length&&"string"==typeof t)delete this._handlers[t];else if(2===arguments.length){var u=[].concat(t);for(e=0,n=u.length;n>e;e++)a=u[e],this._handlers[a]=o(this._handlers[a],r),0===(this._handlers[a]||[]).length&&delete this._handlers[a]}else if(i(t))for(s in t)this.off(s,t[s]);return this},u.prototype.listeners=function(t){var r,e,n,i=this._handlersAll||[],o=!1;if(!t)throw Error("Emitter.listeners: no event provided.");for(i=i.concat(this._handlers[t]||[]),e=0,n=this._handlersComplex.length;n>e;e++)r=this._handlersComplex[e],~t.search(r.pattern)&&(o=!0,i.push(r));return this._handlersAll.length||o?i.sort(function(t,r){return t.order-r.order}):i.slice(0)},u.prototype.emit=function(t,r){if(!this._enabled)return this;if(i(t)){for(var e in t)this.emit(e,t[e]);return this}var n,o,s,a,u,h,c,l=[].concat(t),f=[];for(a=0,h=l.length;h>a;a++){for(o=this.listeners(l[a]),u=0,c=o.length;c>u;u++)s=o[u],n={type:l[a],target:this},arguments.length>1&&(n.data=r),s.fn.call("scope"in s?s.scope:this,n),s.once&&f.push(s);for(u=f.length-1;u>=0;u--)f[u].parent.splice(f[u].parent.indexOf(f[u]),1)}return this},u.prototype.kill=function(){this.unbindAll(),this._handlers=null,this._handlersAll=null,this._handlersComplex=null,this._enabled=!1},u.prototype.disable=function(){return this._enabled=!1,this},u.prototype.enable=function(){return this._enabled=!0,this},u.version="3.0.0","undefined"!=typeof n?("undefined"!=typeof e&&e.exports&&(n=e.exports=u),n.Emitter=u):"function"==typeof t&&t.amd?t("emmett",[],function(){return u}):this.Emitter=u}).call(this)},{}],4:[function(t,r,e){function n(t){return t+"$"+(new Date).getTime()+(""+Math.random()).replace("0.","")}function i(t,r){function e(t){this[t]=function(){var r=this.root[t].apply(this.root,arguments);return r instanceof o?this:r}}if(arguments.length<1&&(t={}),!(this instanceof i))return new i(t,r);if(!d.Object(t)&&!d.Array(t))throw Error("Baobab: invalid data.");if(s.call(this),this.options=h.shallowMerge(p,r),this._transaction={},this._future=void 0,this._cursors={},this.data=h.deepClone(t),this.root=this.select([]),this.facets={},["get","set","unset","update"].forEach(e.bind(this)),!d.Object(this.options.facets))throw Error("Baobab: invalid facets.");for(var n in this.options.facets)this.addFacet(n,this.options.facets[n]);this.mixin=f.baobab(this)}var o=t("./cursor.js"),s=t("emmett"),a=t("./watcher.js"),u=t("./facet.js"),h=t("./helpers.js"),c=t("./update.js"),l=t("./merge.js"),f=t("./mixins.js"),p=t("../defaults.js"),d=t("./type.js");h.inherits(i,s),i.prototype.addFacet=function(t,r){return this.facets[t]=new u(this,r),this},i.prototype.select=function(t){if(!t)throw Error("Baobab.select: invalid path.");if(arguments.length>1&&(t=h.arrayOf(arguments)),!d.Path(t))throw Error("Baobab.select: invalid path.");t=[].concat(t);var r,e=d.ComplexPath(t);e&&(r=h.solvePath(this.data,t,this));var i=t.map(function(t){return d.Function(t)?n("fn"):d.Object(t)?n("ob"):t}).join("|λ|");if(this._cursors[i])return this._cursors[i];var s=new o(this,t,r,i);return this._cursors[i]=s,s},i.prototype.stack=function(t){var r=this;if(!d.Object(t))throw Error("Baobab.update: wrong specification.");return this._transaction=l(t,this._transaction),this.options.autoCommit?this.options.asynchronous?(this._future||(this._future=setTimeout(r.commit.bind(r,null),0)),this):this.commit():this},i.prototype.commit=function(){var t=c(this.data,this._transaction,this.options),r=this.data;return this.data=t.data,this._transaction={},this._future&&(this._future=clearTimeout(this._future)),this.emit("update",{log:t.log,previousState:r}),this},i.prototype.watch=function(t){if(!d.Array(t)||t.some(function(t){return!d.Path(t)}))throw Error("Baobab.watch: invalid paths.");return new a(this,[].concat(t))},i.prototype.release=function(){var t;delete this.data,delete this._transaction;for(t in this._cursors)this._cursors[t].release();delete this._cursors;for(t in this.facets)this.facets[t].release();delete this.facets,this.kill()},i.prototype.toJSON=function(){return this.get()},r.exports=i},{"../defaults.js":2,"./cursor.js":5,"./facet.js":6,"./helpers.js":7,"./merge.js":8,"./mixins.js":9,"./type.js":10,"./update.js":11,"./watcher.js":12,emmett:3}],5:[function(t,r,e){function n(t,r,e,n){function i(t){if(o.isRecording()&&!o.undoing){var r=u.getIn(t,o.solvedPath,o.tree),e=u.deepClone(r);o.archive.add(e)}return o.undoing=!1,o.emit("update")}var o=this;s.call(this),r=r||[],this.tree=t,this.path=r,this.hash=n,this.archive=null,this.undoing=!1,this.complexPath=!!e,this.solvedPath=this.complexPath?e:this.path,this.relevant=void 0!==this.get(),this.updateHandler=function(t){var r=t.data.log,e=t.data.previousState,n=!1;if(o.complexPath&&(o.solvedPath=u.solvePath(o.tree.data,o.path,o.tree)),!o.path.length)return i(e);o.solvedPath&&(n=u.solveUpdate(r,[o.solvedPath]));var s=void 0!==o.get();o.relevant?s&&n?i(e):s||(o.emit("irrelevant"),o.relevant=!1):s&&n&&(o.emit("relevant"),i(e),o.relevant=!0)},this.mixin=a.cursor(this);var h=!1;this._lazyBind=function(){h||(h=!0,o.tree.on("update",o.updateHandler))},this.on=u.before(this._lazyBind,this.on.bind(this)),this.once=u.before(this._lazyBind,this.once.bind(this)),this.complexPath&&this._lazyBind()}function i(t,r,e,n){if(arguments.length>5)throw Error("baobab.Cursor."+t+": too many arguments.");arguments.length<4&&(n=e,e=[]),e=e||[];var i=[].concat(e),o=u.solvePath(this.get(),i,this.tree);if(!o)throw Error("baobab.Cursor."+t+": could not solve dynamic path.");if(r){var s=this.get(o);if(!h[r](s))throw Error("baobab.Cursor."+t+": invalid target.")}var a={};a["$"+t]=n;var c=u.pathObject(o,a);return c}function o(t,r){n.prototype[t]=function(){var e=i.bind(this,t,r).apply(this,arguments);return this.update(e)}}var s=t("emmett"),a=t("./mixins.js"),u=t("./helpers.js"),h=(t("../defaults.js"),t("./type.js"));u.inherits(n,s),n.prototype.isRoot=function(){return!this.path.length},n.prototype.isLeaf=function(){return h.Primitive(this.get())},n.prototype.isBranch=function(){return!this.isLeaf()&&!this.isRoot()},n.prototype.root=function(){return this.tree.root()},n.prototype.select=function(t){if(arguments.length>1&&(t=u.arrayOf(arguments)),!h.Path(t))throw Error("baobab.Cursor.select: invalid path.");return this.tree.select(this.path.concat(t))},n.prototype.up=function(){return this.solvedPath&&this.solvedPath.length?this.tree.select(this.path.slice(0,-1)):null},n.prototype.left=function(){var t=+this.solvedPath[this.solvedPath.length-1];if(isNaN(t))throw Error("baobab.Cursor.left: cannot go left on a non-list type.");return t?this.tree.select(this.solvedPath.slice(0,-1).concat(t-1)):null},n.prototype.leftmost=function(){var t=+this.solvedPath[this.solvedPath.length-1];if(isNaN(t))throw Error("baobab.Cursor.leftmost: cannot go left on a non-list type.");return this.tree.select(this.solvedPath.slice(0,-1).concat(0))},n.prototype.right=function(){var t=+this.solvedPath[this.solvedPath.length-1];if(isNaN(t))throw Error("baobab.Cursor.right: cannot go right on a non-list type.");return t+1===this.up().get().length?null:this.tree.select(this.solvedPath.slice(0,-1).concat(t+1))},n.prototype.rightmost=function(){var t=+this.solvedPath[this.solvedPath.length-1];if(isNaN(t))throw Error("baobab.Cursor.right: cannot go right on a non-list type.");var r=this.up().get();return this.tree.select(this.solvedPath.slice(0,-1).concat(r.length-1))},n.prototype.down=function(){+this.solvedPath[this.solvedPath.length-1];return this.get()instanceof Array?this.tree.select(this.solvedPath.concat(0)):null},n.prototype.get=function(t){arguments.length>1&&(t=u.arrayOf(arguments));var r=this.solvedPath.concat([].concat(t||0===t?t:[]));return u.getIn(this.tree.data,r,this.tree)},o("set"),o("apply"),o("chain"),o("push","Array"),o("unshift","Array"),n.prototype.merge=function(t){if(!h.Object(t))throw Error("baobab.Cursor.merge: trying to merge a non-object.");var r=i.bind(this,"merge","Object").apply(this,arguments);return this.update(r)},n.prototype.unset=function(t){if(void 0===t&&this.isRoot())throw Error("baobab.Cursor.unset: cannot remove root node.");var r=i.bind(this,"unset",null).apply(this,[t,!0]);return this.update(r)},n.prototype.update=function(t,r){if(arguments.length<2)return this.tree.stack(u.pathObject(this.solvedPath,t)),this;var e=[].concat(t),n=u.solvePath(this.get(),e,this.tree);if(!n)throw Error("baobab.Cursor.update: could not solve dynamic path.");return this.tree.stack(u.pathObject(this.solvedPath.concat(n),r)),this},n.prototype.startRecording=function(t){if(t=t||5,1>t)throw Error("baobab.Cursor.startRecording: invalid maximum number of records.");return this.archive?this:(this._lazyBind(),this.archive=u.archive(t),this)},n.prototype.stopRecording=function(){return this.archive=null,this},n.prototype.undo=function(t){if(t=t||1,!this.isRecording())throw Error("baobab.Cursor.undo: cursor is not recording.");if(!h.PositiveInteger(t))throw Error("baobab.Cursor.undo: expecting a positive integer.");var r=this.archive.back(t);if(!r)throw Error("boabab.Cursor.undo: cannot find a relevant record ("+t+" back).");return this.undoing=!0,this.set(r)},n.prototype.isRecording=function(){return!!this.archive},n.prototype.hasHistory=function(){return!(!this.archive||!this.archive.get().length)},n.prototype.getHistory=function(){return this.archive?this.archive.get():[]},n.prototype.release=function(){this.tree.off("update",this.updateHandler),this.hash&&delete this.tree._cursors[this.hash],delete this.tree,delete this.path,delete this.solvedPath,delete this.archive,this.kill()},n.prototype.toJSON=function(){return this.get()},h.Cursor=function(t){return t instanceof n},r.exports=n},{"../defaults.js":2,"./helpers.js":7,"./mixins.js":9,"./type.js":10,emmett:3}],6:[function(t,r,e){function n(t){return t}function i(t,r){function e(t){i[t]=l[t].bind(l)}var i=this,s=null,a=!1,u=r.get||n,h=r.cursors,c=Object.keys(h).map(function(t){return h[t]}),l=new o(t,c);["on","once","release"].forEach(e),this.get=function(){if(a)return s;var r={};for(var e in h)r[e]=t.get(h[e]);return s=u.call(null,r),a=!0,s},this.on("update",function(){a=!1})}{var o=t("./watcher.js");t("./helpers.js")}r.exports=i},{"./helpers.js":7,"./watcher.js":12}],7:[function(t,r,e){(function(e){function n(t){return Array.prototype.slice.call(t)}function i(t,r){return function(){t(),r.apply(null,arguments)}}function o(t,r){var e,n={};for(e in t)n[e]=t[e];for(e in r)n[e]=r[e];return n}function s(t,r){if(t===r)return!0;if("object"!=typeof t||"object"!=typeof r||null===t||null===r)return!1;var e=Object.keys(t),n=Object.keys(r);if(e.length!==n.length)return!1;var i,o;for(i=0,o=e.length;o>i;i++)if(t[e[i]]!==r[e[i]])return!1;return!0}function a(t){var r=t.source,e="";return t.global&&(e+="g"),t.multiline&&(e+="m"),t.ignoreCase&&(e+="i"),t.sticky&&(e+="y"),t.unicode&&(e+="u"),new RegExp(r,e)}function u(t,r){if(!r||"object"!=typeof r||r instanceof Error||"ArrayBuffer"in e&&r instanceof ArrayBuffer)return r;if(w.Array(r)){if(t){var n,i,o=[];for(n=0,i=r.length;i>n;n++)o.push(x(r[n]));return o}return r.slice(0)}if(w.Date(r))return new Date(r.getTime());if(r instanceof RegExp)return a(r);if(w.Object(r)){var s,u={};r.constructor&&r.constructor!==Object&&(u=Object.create(r.constructor.prototype));for(s in r)r.hasOwnProperty(s)&&(u[s]=t?x(r[s]):r[s]);return u}return r}function h(t,r){return function(e){return r(t(e))}}function c(t,r){var e,n;for(e=0,n=t.length;n>e;e++)if(r(t[e]))return t[e]}function l(t,r){var e,n;for(e=0,n=t.length;n>e;e++)if(r(t[e]))return e;return-1}function f(t,r){var e,n=!0;if(!t)return!1;for(e in r)if(w.Object(r[e]))n=n&&f(t[e],r[e]);else if(w.Array(r[e]))n=n&&!!~r[e].indexOf(t[e]);else if(t[e]!==r[e])return!1;return n}function d(t,r){return c(t,function(t){return f(t,r)})}function y(t,r){return l(t,function(t){return f(t,r)})}function b(t,r,e){r=r||[];var n,i,o,s=t;for(i=0,o=r.length;o>i;i++){if(!s)return;if("function"==typeof r[i]){if(!w.Array(s))return;s=c(s,r[i])}else if("object"==typeof r[i])if(e&&"$cursor"in r[i]){if(!w.Path(r[i].$cursor))throw Error("baobab.getIn: $cursor path must be an array.");n=e.get(r[i].$cursor),s=s[n]}else{if(!w.Array(s))return;s=d(s,r[i])}else s=s[r[i]]}return s}function g(t,r,e){var n,i,o,s=[],a=t;for(i=0,o=r.length;o>i;i++){if(!a)return null;if("function"==typeof r[i]){if(!w.Array(a))return;n=l(a,r[i]),s.push(n),a=a[n]}else if("object"==typeof r[i])if(e&&"$cursor"in r[i]){if(!w.Path(r[i].$cursor))throw Error("baobab.getIn: $cursor path must be an array.");p=e.get(r[i].$cursor),s.push(p),a=a[p]}else{if(!w.Array(a))return;n=y(a,r[i]),s.push(n),a=a[n]}else s.push(r[i]),a=a[r[i]]||{}}return s}function v(t,r){var e,n,i,o,s,a,u,h,c;for(e=0,o=r.length;o>e;e++)for(u=r[e],n=0,s=t.length;s>n;n++)for(h=t[n],i=0,a=h.length;a>i&&(c=h[i],c==u[i]);i++)if(i+1===a||i+1===u.length)return!0;return!1}function m(t,r){var e,n=t.length,i={},o=i;for(n||(i=r),e=0;n>e;e++)o[t[e]]=e+1===n?r:{},o=o[t[e]];return i}function _(t,r){t.super_=r;var e=function(){};e.prototype=r.prototype,t.prototype=new e,t.prototype.constructor=t}function j(t){var r=[];return{add:function(e){for(r.unshift(e);r.length>t;)r.pop()},back:function(t){var e=r[t-1];return e&&(r=r.slice(t)),e},get:function(){return r}}}var w=t("./type.js"),$=u.bind(null,!1),x=u.bind(null,!0);r.exports={archive:j,arrayOf:n,before:i,deepClone:x,shallowClone:$,shallowEqual:s,shallowMerge:o,compose:h,getIn:b,inherits:_,pathObject:m,solvePath:g,solveUpdate:v}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./type.js":10}],8:[function(t,r,e){function n(t,r,e){a.forEach(function(r){e!==r&&delete t[r]}),t[e]=r[e]}function i(t,r){var e,u=o.shallowClone(r||{});a.forEach(function(r){t[r]&&n(u,t,r)}),t.$chain&&(a.slice(0,-1).forEach(function(t){delete u[t]}),u.$apply=u.$apply?o.compose(u.$apply,t.$chain):t.$chain),t.$push&&u.$push?u.$push=s.Array(u.$push)?u.$push.concat(t.$push):[u.$push].concat(t.$push):t.$push&&(u.$push=t.$push),t.$unshift&&u.$unshift?u.$unshift=s.Array(t.$unshift)?t.$unshift.concat(u.$unshift):[t.$unshift].concat(u.$unshift):t.$unshift&&(u.$unshift=t.$unshift);for(e in t)s.Object(t[e])?u[e]=i(t[e],u[e]):"$"!==e[0]&&(u[e]=t[e]);return u}var o=t("./helpers.js"),s=t("./type.js"),a=["$unset","$set","$merge","$apply"];r.exports=i},{"./helpers.js":7,"./type.js":10}],9:[function(t,r,e){var n=t("./type.js");r.exports={baobab:function(t){return{mixins:[{getInitialState:function(){if(this.tree=t,!this.cursor&&!this.cursors)return{};if(this.cursor&&this.cursors)throw Error("baobab.mixin: you cannot have both `component.cursor` and `component.cursors`. Please make up your mind.");if(this.__type=null,this.__updateHandler=function(){this.setState(this.__getCursorData())}.bind(this),this.cursor){if(!n.MixinCursor(this.cursor))throw Error("baobab.mixin.cursor: invalid data (cursor, string, array or function).");n.Function(this.cursor)&&(this.cursor=this.cursor()),n.Cursor(this.cursor)||(this.cursor=t.select(this.cursor)),this.__getCursorData=function(){return{cursor:this.cursor.get()}}.bind(this),this.__type="single"}else if(this.cursors){if(!n.MixinCursors(this.cursors))throw Error("baobab.mixin.cursor: invalid data (object, array or function).");if(n.Function(this.cursors)&&(this.cursors=this.cursors()),n.Array(this.cursors))this.cursors=this.cursors.map(function(r){return n.Cursor(r)?r:t.select(r)}),this.__getCursorData=function(){return{cursors:this.cursors.map(function(t){return t.get()})}}.bind(this),this.__type="array";else{for(var r in this.cursors)n.Cursor(this.cursors[r])||(this.cursors[r]=t.select(this.cursors[r]));this.__getCursorData=function(){var t={};for(r in this.cursors)t[r]=this.cursors[r].get();return{cursors:t}}.bind(this),this.__type="object"}}return this.__getCursorData()},componentDidMount:function(){"single"===this.__type?(this.__watcher=this.tree.watch([this.cursor.path]),this.__watcher.on("update",this.__updateHandler)):"array"===this.__type?(this.__watcher=this.tree.watch(this.cursors.map(function(t){return t.path})),this.__watcher.on("update",this.__updateHandler)):"object"===this.__type&&(this.__watcher=this.tree.watch(Object.keys(this.cursors).map(function(t){return this.cursors[t].path},this)),this.__watcher.on("update",this.__updateHandler))},componentWillUnmount:function(){this.__watcher&&this.__watcher.release()}}].concat(t.options.mixins)}},cursor:function(t){return{mixins:[{getInitialState:function(){return this.cursor=t,this.__updateHandler=function(){this.setState({cursor:this.cursor.get()})}.bind(this),{cursor:this.cursor.get()}},componentDidMount:function(){this.cursor.on("update",this.__updateHandler)},componentWillUnmount:function(){this.cursor.off("update",this.__updateHandler)}}].concat(t.tree.options.mixins)}}}},{"./type.js":10}],10:[function(t,r,e){function n(t,r){return r.some(function(r){return i[r](t)})}var i={};i.Array=function(t){return Array.isArray(t)},i.Object=function(t){return t&&"object"==typeof t&&!Array.isArray(t)&&!(t instanceof Function)},i.String=function(t){return"string"==typeof t},i.Number=function(t){return"number"==typeof t},i.PositiveInteger=function(t){return"number"==typeof t&&t>0&&t%1===0},i.Function=function(t){return"function"==typeof t},i.Primitive=function(t){return"string"==typeof t||"number"==typeof t||"boolean"==typeof t},i.Date=function(t){return t instanceof Date},i.NonScalar=function(t){return i.Object(t)||i.Array(t)},i.Path=function(t){var r=["String","Number","Function","Object"];return i.Array(t)?t.every(function(t){return n(t,r)}):n(t,r)},i.MixinCursor=function(t){return n(t,["String","Number","Array","Function","Cursor"])},i.MixinCursors=function(t){return n(t,["Object","Array","Function"])},i.ComplexPath=function(t){return t.some(function(t){return n(t,["Object","Function"])})},r.exports=i},{}],11:[function(t,r,e){function n(t,r){var e=new Error("baobab.update: "+r+" at path /"+t.slice(1).join("/"));return e.path=t,e}var i=t("./helpers.js"),o=t("./type.js");r.exports=function(t,r,e){if(e=e||{},!o.Object(t)&&!o.Array(t))throw Error("baobab.update: invalid target.");var s={};t={root:i.shallowClone(t)};var a=function(t,r,e,u){e=e||["root"];var h,c,l,f=e.join("|λ|"),p=e[e.length-1],d=Object.keys(r).some(function(t){return!!~["$unset","$set","$apply","$merge","$push","$unshift"].indexOf(t)});if(d){s[f]=!0;for(c in r){if("$unset"===c){var y=e[e.length-2];o.Array(t)?u[y]=t.slice(0,+p).concat(t.slice(+p+1)):(u[y]=i.shallowClone(t),delete u[y][p]);break}if("$set"===c){l=r.$set,t[p]=l;break}if("$apply"===c){if(h=r.$apply,"function"!=typeof h)throw n(e,"using command $apply with a non function");t[p]=h.call(null,t[p]);break}if("$merge"===c){if(l=r.$merge,!o.Object(t[p])||!o.Object(l))throw n(e,"using command $merge with a non object");t[p]=i.shallowMerge(t[p],l);break}if("$push"===c){if(l=r.$push,!o.Array(t[p]))throw n(e,"using command $push to a non array");t[p]=t[p].concat(l)}if("$unshift"===c){if(l=r.$unshift,!o.Array(t[p]))throw n(e,"using command $unshift to a non array");t[p]=[].concat(l).concat(t[p])}}}else for(c in r)t[p][c]="undefined"==typeof t[p][c]?{}:i.shallowClone(t[p][c]),a(t[p],r[c],e.concat(c),t)};return a(t,r),{data:t.root,log:Object.keys(s).map(function(t){return t.split("|λ|").slice(1)})}}},{"./helpers.js":7,"./type.js":10}],12:[function(t,r,e){function n(t,r){function e(){u&&(a=r.map(function(t){return o.solvePath(n.tree.data,t,n.tree)}))}var n=this;i.call(this),this.tree=t;var a=r,u=r.some(s.ComplexPath);this.updateHandler=function(t){var r=o.solveUpdate(t.data.log,a);r&&n.emit("update")},e(),this.tree.on("update",this.updateHandler)}var i=t("emmett"),o=t("./helpers.js"),s=t("./type.js");o.inherits(n,i),n.prototype.release=function(){this.tree.off("update",this.updateHandler),this.tree=null,this.kill()},r.exports=n},{"./helpers.js":7,"./type.js":10,emmett:3}]},{},[1])(1)});